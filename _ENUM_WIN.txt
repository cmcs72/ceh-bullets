 ===[ NMAP ]===
 Nmap comes with several SMB-related scripts such as (cd /usr/share/nmap/scripts; ls |  grep smb):

	nmap -p 139,445 --script [script name] X.X.X.X
	
	- smb-brute – Performs brute-force password auditing against SMB servers.
	- smb-system-info – Collects system information through SMB/NetBios.
	- smb-vuln-smb/cve* – Identifies whether the SMB server is vulnerable to any known exploits.
	- smb-os-discovery - enumerate the Operating System of target system along with other ( Computer,Domain and Forest Name ecc ecc )
	- smb-enum-shares – Enumerates SMB shares in an SMB server.
	- smb-enum-users - enumerate all users on remote Windows system using 2 different techniques ( SAMR Enumeration,LSA Bruteforcing )
	- smb-enum-domains - enumerate all domains on remote Windows system
	- smb-enum-groups - enumerate all groups on remote Windows system
	- smb-enum-processes - enumerate all processes on remote Windows system
	- mb-enum-services - enumerate all services on remote Windows system
	- smb-enum-sessions - enumerate all sessions on remote Windows system
	- nbtstat - enumerate the target’s NetBIOS names and MAC address
	
	It is good practice to run smb-enum* to collect general information about the server and smb-vuln* to collect information about any known exploits that might affect the server..
			
    sudo nmap --script smb-enum-shares -p 139,445 <Target IP> OR sudo nmap --script smb-enum* -p 139,445 <Target IP> --> enumerate all ( shares, users, groups ecc ecc )
 
	sudo nmap --script smb-vuln* -p 139,445 <Target IP> --> NSE Script to check for vulnerabilities , * stand for check all
	
 
 ===[ SMBCLIENT ]===
 smbclient -L <target IP> --> list share
	-L	list share ( or enum share ) 
	-N Anonymous user ( current user)
 
 smbclient [-U username] [-P password or -N for no password] -L \\\\X.X.X.X --> list share as current user without password
 smbclient [-U username] [-P password or -N for no password] \\\\X.X.X.X\\share	--> connect to share as current user without password
 
 ===[ SMBMAP ]===
 smbmap -H <Target IP> --> enumerate the target IP as unathenticated user
 -H Host
 -P port ( opt. )
 -u user
 -p password
 -p "<NT>:<LM>" NTLM hashes for password
 -r [Folder] --> NON recursive listing
 -R [Folder] --> recursive listing
 -A <filename> --> search for a filename
 -q for quiet verbose output
 
 ===[ RPCCLIENT ]===
 rpcclient -U "" -N <Target IP>
 -U username ("" null )
 -N Target IP
 –pw-nt-hash	use hash password format
 ONCE CONNECTED:
	queryuser	Retrieve user information
	querygroup	Retrieve group information
	querydominfo	Retrieve domain information
	enumdomusers	Enumerate domain users
	lookupsids	Look up SIDs to usernames
	lsaaddacctrights	Add rights to a user account
 
 and other commands
 
 ===[ ENUM4LINUX ]===
 enum4linux -U <target IP> --> User ( and others )
 
 ===[ CRACKMAPEXEC ]===
 https://github.com/byt3bl33d3r/CrackMapExec
 For documentation and usage examples, visit: https://www.netexec.wiki/
 
 usage: cme [-h] [-t THREADS] [--timeout TIMEOUT] [--jitter INTERVAL] [--verbose] [--debug] [--no-progress] [--log LOG] [-6] [--dns-server DNS_SERVER]
           [--dns-tcp] [--dns-timeout DNS_TIMEOUT] [--version]
           {mssql,winrm,ldap,smb,ssh,vnc,wmi,ftp,rdp} ...

    Version : 1.2.0
    Codename: ItsAlwaysDNS
    Commit  : 68589588
    

options:
  -h, --help            show this help message and exit
  --version             Display nxc version

Generic:
  Generic options for nxc across protocols

  -t THREADS, --threads THREADS
                        set how many concurrent threads to use
  --timeout TIMEOUT     max timeout in seconds of each thread
  --jitter INTERVAL     sets a random delay between each authentication

Output:
  Options to set verbosity levels and control output

  --verbose             enable verbose output
  --debug               enable debug level information
  --no-progress         do not displaying progress bar during scan
  --log LOG             export result into a custom file

DNS:
  -6                    Enable force IPv6
  --dns-server DNS_SERVER
                        Specify DNS server (default: Use hosts file & System DNS)
  --dns-tcp             Use TCP instead of UDP for DNS queries
  --dns-timeout DNS_TIMEOUT
                        DNS query timeout in seconds

Available Protocols:
  {mssql,winrm,ldap,smb,ssh,vnc,wmi,ftp,rdp}
    mssql               own stuff using MSSQL
    winrm               own stuff using WINRM
    ldap                own stuff using LDAP
    smb                 own stuff using SMB
    ssh                 own stuff using SSH
    vnc                 own stuff using VNC
    wmi                 own stuff using WMI
    ftp                 own stuff using FTP
    rdp                 own stuff using RDP

	cme smb 10.10.11.174		--> SMB Enumeration brief
	SMB         10.10.11.174    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False)
	
	cme smb 10.10.11.174 --shares	--> SMB share Enumeration 
	SMB         10.10.11.174    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False)
	SMB         10.10.11.174    445    DC               [-] Error getting user: list index out of range
	SMB         10.10.11.174    445    DC               [-] Error enumerating shares: STATUS_USER_SESSION_DELETED

	cme smb 10.10.11.174 --shares -u '' -p ''	--> SMB share Enumeration with null auth
	SMB         10.10.11.174    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False)
	SMB         10.10.11.174    445    DC               [+] support.htb\: 
	SMB         10.10.11.174    445    DC               [-] Error enumerating shares: STATUS_ACCESS_DENIED
	
	cme smb 10.10.11.174 --shares -u 'pippo' -p ''	--> SMB share Enumeration with Anonymous (or guest ?) auth
	SMB         10.10.11.174    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:support.htb) (signing:True) (SMBv1:False)
	SMB         10.10.11.174    445    DC               [+] support.htb\pippo: 
	SMB         10.10.11.174    445    DC               [*] Enumerated shares
	SMB         10.10.11.174    445    DC               Share           Permissions     Remark
	SMB         10.10.11.174    445    DC               -----           -----------     ------
	SMB         10.10.11.174    445    DC               ADMIN$                          Remote Admin
	SMB         10.10.11.174    445    DC               C$                              Default share
	SMB         10.10.11.174    445    DC               IPC$            READ            Remote IPC
	SMB         10.10.11.174    445    DC               NETLOGON                        Logon server share 
	SMB         10.10.11.174    445    DC               support-tools   READ            support staff tools
	SMB         10.10.11.174    445    DC               SYSVOL                          Logon server share 

 
 
  ===[ NMBLOOKUP ]===
 nmblookup -A <Target IP>  --> host enumeration by IP Address
    00: Workstation Service (workstation name)
    03: Windows Messenger service
    06: Remote Access Service
    20: File Service (also called Host Record)
    21: Remote Access Service client
    1B: Domain Master Browser – Primary Domain Controller for a domain
    1D: Master Browser
    1C: Domain Controllers for a domain
    1E: Browser Service Elections
 
 ===[ NMBSCAN ]===
 nbtscan -r <target IP[24]>	--> host[/network] enumeration by IP Address

 ===[ METASPLOIT ]===
	msf6> use auxiliary/scanner/smb/smb_enumshares
	msf6> auxiliary(scanner/smb/smb_enumshares) > set rhosts <target IP>
	msf6> auxiliary(scanner/smb/smb_enumshares) > set smbuser <username>
	msf6> auxiliary(scanner/smb/smb_enumshares) > set smbpass <password>
	msf6> auxiliary(scanner/smb/smb_enumshares) > exploit

 ===[ IMPACKET ]===
 https://github.com/SecureAuthCorp/impacket

 ====[ SMB VERSION ]====
 Protocol	Client			Server						DATA ONTAP
 SMB1.0		Windows XP		Windows Server 2000/2003	All
 SMB2.0		Windows Vista	Windows Server 2008			7.3.1 and Later, 8.x
 SMB2.1		Windows 7		Windows Server 2008R2		8.1 clustered Data ONTAP; 8.1.1 7-Mode
 SMB3.0		Windows 8		Windows Server 2012			clustered Data ONTAP 8.2 and later
 SMB3.02	Windows 8		Windows Server 2012R2
 SMB3.1		Windows 10		Windows Server 20016		ONTAP 9



evil-winrm -i 10.129.37.195 -u 'emily.oscars' -p 'Q!3@Lp#M6b*7t*Vt'

whoami /priv


 ===[ LDAPSEARCH ]===
 
  ldapsearch -x -b "dc=htb,dc=local" -H ldap://10.10.10.161 ( ATTENZIONE ALLA SINTASSI --> POTREBBE ESSERE DIFFERENTE )
	-x	use simple auth
	-b 	basename domain
	-H  ldap server 
	
 ldapsearch -x -b "dc=htb,dc=local" -H ldap://10.10.10.161 '(objectClass=Person)' sAMAccountName
	'(objectClass=Person|User)'	query for element classified as person or user
	sAMAccountName			restrict query to account name only
 '{ print $2 }' 